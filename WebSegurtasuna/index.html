<!DOCTYPE html>
<html lang="en">
<head>
    <title>Web Segurtasuna</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../ShowerTemplate/shower/themes/ribbon/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
</head>
<body class="shower list">
    <header class="caption">
        <h1>Web Segurtasuna</h1>
        <p>Mikel Egaña Aranguren</p>
    </header>

    <section class="slide" id="cover">
        <h2>Web Segurtasuna</h2>
        <p>Mikel Egaña Aranguren</p>
        <p><a href="https://mikel-egana-aranguren.github.io/">mikel-egana-aranguren.github.io</a></p>
        <p><a href="mailto:mikel.egana@ehu.eus">mikel.egana@ehu.eus</a></p>
        <img src="../ShowerTemplate/pictures/ehu.png" alt="UPV/EHU ingenieros San Mames" height="25%" border="1px solid #555">
    </section>

    <section class="slide">
        <h2>Web Segurtasuna</h2>
        <p><a href="https://doi.org/10.5281/zenodo.4302267">https://doi.org/10.5281/zenodo.4302267</a></p>
        <p><a href="https://github.com/mikel-egana-aranguren/EHU-SGSSI-01">https://github.com/mikel-egana-aranguren/EHU-SGSSI-01</a></p>
        <img src="../ShowerTemplate/pictures/by.png" alt="Creative Commons BY" height="10%">
    </section>

    <section class="slide">
        <h2>Pen-testing</h2>
        Penetration testing: sistema batean erasotzaile potentzial baten tresna berberak erabiliz sartzen saiatzea, ahuleziak aurkitzeko eta konpontzeko<br><br>
    </section>


    <section class="slide">
        <h2>Urrakortasun nagusiak Web Sistemetan</h2>
        La <a href="https://owasp.org/">Open Web Application Security Project (OWASP)</a> Urrakortasun ohikoenak aztertzen ditu<br><br>
        aldizkako txostena: OWASP Top Ten (<del>2017</del>, <a href="https://owasp.org/Top10/">2021</a>)
    </section>

    <section class="slide">
    <h2>Urrakortasun nagusiak Web Sistemetan</h2>
    <p><img  style="border: 1px solid #555;"  src="pictures-sgssi-01/owasp-top-10.png" alt="OWASP Top 10 2017 2021" width="90%"></p>
    </section>

    <section class="slide">
        <h2>Common Weakness Enumerations (CWEs)</h2>
        <p><a href="https://cwe.mitre.org/">https://cwe.mitre.org/</a></p>
    </section>

    <section class="slide">
        <h2>Urrakortasun nagusiak Web Sistemetan</h2>
        <ul>
            <li>Sarbide-kontrola apurtzea</li>
            <li>Akats kriptografikoak</li>
            <li>Injekzioa</li>
            <li>Diseinu insegurua</li>
            <li>Segurtasun-konfigurazio eskasa</li>
            <li>Osagai kalteberak eta zaharkituak</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Urrakortasun nagusiak Web Sistemetan</h2>
        <ul>
            <li>Identifikazio- eta autentifikazio-akatsak</li>
            <li>Akatsak datuen eta softwarearen osotasunean</li>
            <li>Akatsak segurtasunaren monitorizazioan</li>
            <li>Server-Side Request Forgery (SSRF)</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea</h2>
         <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Broken access control (A01:2021)</a>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea</h2>
        <p>El control de acceso obliga al usuario a actuar solo dentro de los límites establecidos por los permisos definidos</p>
        <p>Fallar en el control de acceso resulta en consecuencias graves</p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: vulnerabilidades</h2>
        <p>Violación del principio de "denegación por defecto": el acceso solo debería ser garantizado a ciertas capacidades, roles, o usuarios, pero está al alcance de cualquiera</p>
        <p><img  style="border: 1px solid #555;"  src="pictures-sgssi-01/GAUR-guias-docentes-rotura-control-acceso.png" alt="En el mantenimiento de las guias docentes de GAUR el primer profesor que acceda a la guia, aunque no tenga permisos, se queda con la guia y la puede modificar si quiere" title="En el mantenimiento de las guias docentes de GAUR el primer profesor que acceda a la guia, aunque no tenga permisos, se queda con la guia y la puede modificar si quiere" width="70%"></p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: vulnerabilidades</h2>
        <p>Burlar el control de acceso mediante parametros URL o las peticiones APIs</p>
        <p>Acceder a una cuenta personal e incluso modificar los datos con el identificador del usuario</p>
        <p>Acceso API sin control para los metodos HTTP POST, PUT, y DELETE</p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: vulnerabilidades</h2>
        <p><b>Elevación de privilegio:</b> actuar como administrador estando logeado como usuario</p>
        <p>Replaying o modificación de JSON Web Token (JWT) para elevar privilegios</p>
        <p>Mala configuración de CORS permite acceso API desde origenes no autorizados</p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: vulnerabilidades</h2>
        <ul>
            <li><a href="https://cwe.mitre.org/data/definitions/200.html">CWE-200: Exposure of Sensitive Information to an Unauthorized Actor</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/201.html">CWE-201: Insertion of Sensitive Information Into Sent Data</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/352.html">CWE-352: Cross-Site Request Forgery (CSRF)</a></li>
            <li>...</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: prevención</h2>
        <p>Denegación por defecto para todos los recursos, excepto públicos</p>
        <p>Implementar mecanismos de acceso de control una sola vez y extenderlos a toda la aplicación, minimizando el uso de CORS</p>
        <p>No permitir listado de directorios y asegurarse de que no hay archivos de metadatos (ej. Git) ni de backups en el nivel root de la aplicación</p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: prevención</h2>
        <p>Logear todos los intentos de entrada, alertar a los administradores cuando sea necesario (ej. muchos accesos fallidos)</p>
        <p>Limitar la tasa de peticiones de API para evitar ataques mediante programas</p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: prevención</h2>
        <p>Identificadores de sesión:
            <ul>
                <li>De servidor (stateful): invalidar al deslogearse</li>
                <li>Stateless JWT tokens: muy poca vida</li>
                <li>Para JWT de tiempo más largo, seguir el protocolo <a href="https://oauth.net/">OAuth</a> de cara a revocar el acceso</li>
            </ul>
        </p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: ejemplo</h2>
        <p>Llamada a SQL para obtener información de cuenta, con datos sin verificar:</p>
        <pre>
            <code>pstmt.setString(1, request.getParameter("acct"));</code>
            <code>ResultSet results = pstmt.executeQuery( );</code>
        </pre>
        <p>El atacante solo tiene que usar la URL <b>https://example.com/app/accountInfo?acct=notmyacct</b></p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak</h2>
        <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Cryptographic Failures (A02:2021)</a>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak</h2>
        <p>Fallos en los métodos criptográficos usados que resultan en exposición de datos</p>
        <p>Determinar las necesidades de protección de los datos tanto en transmisión como en almacenamiento (At rest): leyes de protecciones de datos</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak</h2>
        <p>¿Los datos se transmiten como texto plano? Tanto en conexiones externas como internas (ej. servidores de balance de carga): HTTP, SMTP, FTP ...</p>
        <p>¿Se usan algoritmos o protocolos obsoletos o débiles?</p>
        <p>¿Se usan claves débiles o claves por defecto?</p>
        <p>¿Se aplica una Gakoen kudeaketa adecuada?</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa</h2>
        Ciclo de vida de una clave:
        <ol>
            <li>Generación</li>
            <li>Distribución</li>
            <li>Uso</li>
            <li>Almacenamiento</li>
            <li>Rotación, recovación, destrucción</li>
        </ol>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: generación</h2>
        <p>Evitar algoritmos débiles</p>
        <p>Usar Key Generators o Random Number Generators de alta entropía </p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: distribución</h2>
        <p>Usar conexiones seguras como SSL/TLS para evitar ataques Man in the middle</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: uso</h2>
        <p>Asegurar que solo las personas autorizadas usan la clave</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: almacenamiento</h2>
        <p>Idealmente usar hardware dedicado: <a href="https://en.wikipedia.org/wiki/Hardware_security_module">Hardware Security Module</a>:
            <ul>
                <li>Dejan de funcionar cuando hay un acceso físico</li>
                <li>Cumplen estándares rigurosos como <a href="https://csrc.nist.gov/publications/detail/fips/140/3/final">FIPS 140-2</a> (Nivel 4)</li>
            </ul>
        </p>
        <p>También se pueden usar servicios en la nube: <a href="https://cloud.google.com/security-key-management">Google Cloud Key Management</a></p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: rotación</h2>
        <p>Cuando una clave agota su periodo de validez, se retira, descifrando y volviendo a cifrar los datos con una clave nueva</p>
        <p>Cuanto más tiempo esté una clave en circulación, más probable que sea comprometida</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: revocación o destrucción</h2>
        <p>Si una clave ha sido comprometida, hay que revocarla, aunque este dentro de su periodo de validez</p>
        <p>Hay estándares que exigen guardar la clave revocada, por si hiciera falta en el futuro para descifrar datos (ej. en un juicio)</p>
        <p>La destrucción completa de la clave implica no poder usarla en el futuro</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: buenas prácticas</h2>
        <p>No escribir valores de la clave en el código de software, aunque sea seguro</p>
        <p>Principio del menor privilegio: un usuario debería tener acceso sólo a las claves que realmente necesita</p>
        <p>Usar HSMs</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: buenas prácticas</h2>
        <p>Automatizar la Gakoen kudeaketa lo más posible</p>
        <p>Dividir la generación, distribución etc. entre diferentes personas</p>
        <p>Dividir las claves en fragmentos</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak</h2>
        <p>¿El certificado del servidor es válido y de confianza, garantizado por un AC?</p>
        <p>¿Se usan las contraseñas de los usuarios directamente como claves, en vez de usar password-based key derivation functions (PBKDFs)?</p>
        <p>¿Es la semilla de aleatoriedad usada lo suficientemente fuerte?</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: prevención</h2>
        <p>Clasificar los datos transmitidos, procesados y almacenados según su nivel de exigencia de privacidad</p>
        <p>Almacenar la menor cantidad de datos sensibles posible, incluso usando métodos como <a href="https://www.securitymetrics.com/blog/what-tokenization-and-how-can-i-use-it-pci-dss-compliance">Tokenización</a></p>
        <p>Cifrar todos los datos almacenados (Encription at rest)</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: prevención</h2>
        <p>Usar algoritmos actualizados (No usar MD5, SHA1, ...), claves fuertes, y Gakoen kudeaketa</p>
        <p>Cifrar todos los datos en transito con protocolos como TLS FS (TLS + Forward Secrecy)</p>
        <p>No permitir el uso de caches en el cliente para datos sensibles</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: prevención</h2>
        <p>Almacenar contraseñas con hashes + sal</p>
        <p>Usar semillas con la mayor entropia posible</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: ejemplos</h2>
        <p>Una aplicación usa la función por defecto de la base de datos para encriptar datos. Sin embargo estos datos se desencriptan automáticamente al consultarlos, permitiendo el acceso si por ejemplo hay un ataque de Injekzioa SQL</p> 
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: ejemplos</h2>
        <p>Una web no obliga al uso de TLS. Si un atacante monitoriza el tráfico y "baja" una conexión de HTTPS a HTTP puede interceptar consultas y conseguir la cookie de sesión del usuario. El atacante reenvia la cookie (replay) secuestrando la sesión del usuario y obteniendo acceso a los datos de usuario</p>
        <p>La base de datos usa hashes sin sal. Un atacante puede pre-calcular los hashes con <a href="https://en.wikipedia.org/wiki/Graphics_processing_unit">GPUs</a></p>  
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: vulnerabilidades</h2>
        <ul>
            <li><a href="https://cwe.mitre.org/data/definitions/259.html">CWE-259: Use of Hard-coded Password</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/327.html">CWE-327: Broken or Risky Crypto Algorithm</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/331.html">CWE-331: Insufficient Entropy</a></li>
            <li>...</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Injekzioa</h2>
         <a href="https://owasp.org/Top10/A03_2021-Injection/">Injection (A03:2021)</a>
    </section>

    <section class="slide">
        <h2>Injekzioa</h2>
        Una aplicación es vulnerable si:
        <ul>
            <li>Los datos que provee el usuario no se validan, filtran, o limpian</li>
            <li>El intérprete usa directamente consultas dinámicas o llamadas no parametrizadas sin "escaping"</li>
            <li>Datos hostiles introducidos por el usuario son usados directamente. La sentencia SQL o comando que se use contiene estructuras/datos maliciosos en consultas dinámicas, comandos, o procedimientos almacenados</li>
        </ul>

    </section>

    <section class="slide">
        <h2>Injekzioa SQL</h2>
        <p><img  style="border: 1px solid #555;"  src="pictures-sgssi-01/boy.png" alt="Bobby tables" width="90%"></p>
        <p style="text-align:left;font-size:30%;"><a href="https://xkcd.com/327/">https://xkcd.com/327/</a></p>
    </section>

    <section class="slide">
        <h2>Injekzioa SQL</h2>
        <pre><code>
txtUserId = getRequestString("UserId");
txtSQL = "SELECT * FROM Users 
WHERE UserId = " + txtUserId;
        </code></pre> 
    </section>

    <section class="slide">
        <h2>Injekzioa SQL</h2>
        Input web: <code>105 OR 1=1</code>
        <pre><code>SELECT * FROM Users WHERE UserId = 105 OR 1=1;
        </code></pre>
        OR 1=1 es siempre true, va a devolver todas las lineas de la columna Users 
    </section>

    <section class="slide">
        <h2>Consultas parametrizadas</h2>
        <p>Parametros: valores que se añaden a la consulta al ejecutarla y son analizadas de forma literal (ej. si la variable hace referencia a nombres de columnas, el interprete se asegura de que los parametros son nombres de columnas antes de añadirlas a la consulta y ejecutarla) </p>   
    </section>

    <section class="slide">
        <h2>Consultas parametrizadas</h2>
        <pre><code>
$stmt = $dbh->prepare("INSERT INTO Customers 
(CustomerName,Address,City) 
VALUES (:nam, :add, :cit)");
$stmt->bindParam(':nam', $txtNam);
$stmt->bindParam(':add', $txtAdd);
$stmt->bindParam(':cit', $txtCit);
$stmt->execute();
        </code></pre>    
    </section>

    <section class="slide">
        <h2>Object-Relational Mapping (ORM)</h2>
        <p>Frameworks que traducen el contenido de la base de datos a objetos</p>
        <p>No hay una conexion directa con la base de datos</p>
    </section>

    <section class="slide">
        <h2>Object-Relational Mapping (ORM)</h2>
        <pre><code>
String sql = "SELECT ... FROM persons WHERE id = 10"
DbCommand cmd = new DbCommand(connection, sql);
Result res = cmd.Execute();
String name = res[0]["FIRST_NAME"];
Person p = repository.GetPerson(10);
String name = p.FirstName;
        </code></pre>
    </section>

    <section class="slide">
        <h2>Injekzioa: detección de vulnerabilidad</h2>
        <p>Revisión del código fuente</p>
        <p>Testeo automatizado de inputs en forma de parametros, cabeceras HTTP, URLs, cookies, JSON, y XML</p>
        <p>Application Security Testing en pipelines de <a href="https://github.com/mikel-egana-aranguren/Transparent-Relations-Ontology/blob/main/.github/workflows/robot.yml">Integración Continua</a>/Despliegue Continuo</p>
        
    </section>

    <section class="slide">
        <h2>Injekzioa: prevención</h2>
        <p>Usar APIs seguras que no usen el intérprete. Si no es posible, usar llamadas parametrizadas u ORM</p>
        <p>Validar los inputs</p>
        <p>"Escapar" todos los caracteres especiales posibles</p>
        <p>Usar controles como LIMIT en SQL para evitar perdida masiva de datos</p>        
    </section>

    <section class="slide">
        <h2>Injekzioa</h2>
        <ul>
            <li><a href="https://cwe.mitre.org/data/definitions/79.html">CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/89.html">CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/73.html">CWE-73: External Control of File Name or Path</a></li>
            <li>...</li>
        </ul>
    </section>





    
    <!-- FOOTER -->

    <footer class="badge">
        <a href="https://github.com/mikel-egana-aranguren/EHU-SGSSI-01">Fork me on GitHub</a>
    </footer>

    <div class="progress"></div>

    <script src="../ShowerTemplate/shower/shower.js"></script>
    <!-- Copyright © 3000 Yours Truly, Famous Inc. -->

</body>
</html>
