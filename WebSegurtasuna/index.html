<!DOCTYPE html>
<html lang="en">
<head>
    <title>Web Segurtasuna</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../ShowerTemplate/shower/themes/ribbon/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
</head>
<body class="shower list">
    <header class="caption">
        <h1>Web Segurtasuna</h1>
        <p>Mikel Egaña Aranguren</p>
    </header>

    <section class="slide" id="cover">
        <h2>Web Segurtasuna</h2>
        <p>Mikel Egaña Aranguren</p>
        <p><a href="https://mikel-egana-aranguren.github.io/">mikel-egana-aranguren.github.io</a></p>
        <p><a href="mailto:mikel.egana@ehu.eus">mikel.egana@ehu.eus</a></p>
        <img src="../ShowerTemplate/pictures/ehu.png" alt="UPV/EHU ingenieros San Mames" height="25%" border="1px solid #555">
    </section>

    <section class="slide">
        <h2>Web Segurtasuna</h2>
        <p><a href="https://doi.org/10.5281/zenodo.4302267">https://doi.org/10.5281/zenodo.4302267</a></p>
        <p><a href="https://github.com/mikel-egana-aranguren/EHU-SGSSI-01">https://github.com/mikel-egana-aranguren/EHU-SGSSI-01</a></p>
        <img src="../ShowerTemplate/pictures/by.png" alt="Creative Commons BY" height="10%">
    </section>

    <section class="slide">
        <h2>Pen-testing</h2>
        Penetration testing: sistema batean erasotzaile potentzial baten tresna berberak erabiliz sartzen saiatzea, ahuleziak aurkitzeko eta konpontzeko<br><br>
    </section>


    <section class="slide">
        <h2>Urrakortasun nagusiak Web Sistemetan</h2>
        La <a href="https://owasp.org/">Open Web Application Security Project (OWASP)</a> Urrakortasun ohikoenak aztertzen ditu<br><br>
        aldizkako txostena: OWASP Top Ten (<del>2017</del>, <a href="https://owasp.org/Top10/">2021</a>)
    </section>

    <section class="slide">
    <h2>Urrakortasun nagusiak Web Sistemetan</h2>
    <p><img  style="border: 1px solid #555;"  src="pictures-sgssi-01/owasp-top-10.png" alt="OWASP Top 10 2017 2021" width="90%"></p>
    </section>

    <section class="slide">
        <h2>Common Weakness Enumerations (CWEs)</h2>
        <p><a href="https://cwe.mitre.org/">https://cwe.mitre.org/</a></p>
    </section>

    <section class="slide">
        <h2>Urrakortasun nagusiak Web Sistemetan</h2>
        <ul>
            <li>Sarbide-kontrola apurtzea</li>
            <li>Akats kriptografikoak</li>
            <li>Injekzioa</li>
            <li>Diseinu insegurua</li>
            <li>Segurtasun-konfigurazio eskasa</li>
            <li>Osagai kalteberak eta zaharkituak</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Urrakortasun nagusiak Web Sistemetan</h2>
        <ul>
            <li>Identifikazio- eta autentifikazio-akatsak</li>
            <li>Akatsak datuen eta softwarearen osotasunean</li>
            <li>Akatsak segurtasunaren monitorizazioan</li>
            <li>Server-Side Request Forgery (SSRF)</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea</h2>
         <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Broken access control (A01:2021)</a>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea</h2>
        <p>Sarbide-kontrolaren ondorioz, definitutako baimenek ezarritako mugen barruan bakarrik jardun behar du erabiltzaileak</p>
        <p>Sarbide-kontrolean huts egiteak ondorio larriak dakartza</p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: ahuleziak</h2>
        <p>"Ukatzea lehenetsia" printzipioa urratzea: sarbidea gaitasun, rol edo erabiltzaile jakin batzuei bakarrik bermatu beharko litzaieke, baina edozeinen esku dago</p>
        <p><img  style="border: 1px solid #555;"  src="pictures-sgssi-01/GAUR-guias-docentes-rotura-control-acceso.png" alt="En el mantenimiento de las guias docentes de GAUR el primer profesor que acceda a la guia, aunque no tenga permisos, se queda con la guia y la puede modificar si quiere" title="En el mantenimiento de las guias docentes de GAUR el primer profesor que acceda a la guia, aunque no tenga permisos, se queda con la guia y la puede modificar si quiere" width="70%"></p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: ahuleziak</h2>
        <p>Sarbide-kontrola URL parametroen edo API eskaeren bidez saihestea</p>
        <p>Kontu pertsonal batera sartu eta datuak aldatu erabiltzailearen identifikatzailearekin</p>
        <p>API sarbidea kontrolik gabe HTTP POST, PUT, eta DELETE metodoetarako</p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: ahuleziak</h2>
        <p><b>Pribilegioa igotzea:</b> administratzaile gisa jardutea, erabiltzaile gisa logeatuta egonik
        </p>
        <p>Replaying edo JSON Web Token (JWT) aldatzea pribilegioak igotzeko</p>
        <p>CORSen konfigurazio okerreak baimendu gabeko jatorrietatik APIra sartzeko aukera ematen du
        </p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: ahuleziak</h2>
        <ul>
            <li><a href="https://cwe.mitre.org/data/definitions/200.html">CWE-200: Exposure of Sensitive Information to an Unauthorized Actor</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/201.html">CWE-201: Insertion of Sensitive Information Into Sent Data</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/352.html">CWE-352: Cross-Site Request Forgery (CSRF)</a></li>
            <li>...</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: prebentzioa</h2>
        <p>Lehenetsitako ukapena baliabide guztietarako, publikoak izan ezik</p>
        <p>Kontrolerako sarbide-mekanismoak behin bakarrik ezartzea eta aplikazio osora zabaltzea, CORSen erabilera minimizatuz</p>
        <p>Direktorioen zerrendaketa ez baimentzea eta aplikazioaren root mailan metadatuen fitxategirik (adibidez, Git) edo backup-ik ez dagoela ziurtatzea</p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: prebentzioa</h2>
        <p>Sartzeko ahalegin guztiak logeatzea, administratzaileak ohartaraztea beharrezkoa denean (adibidez, huts egindako sarbide asko)</p>
        <p>APIetan eskaeren tasa mugatzea, programen bidezko erasoak saihesteko</p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: prebentzioa</h2>
        <p>Saioaren identifikatzaileak:
            <ul>
                <li>Zerbitzariarena (stateful): baliogabetzea deslogeatzean</li>
                <li>Stateless JWT tokens: oso bizitza laburra</li>
                <li>Denbora luzeagoko JWTrentzat, jarraitu <a href="https://oauth.net/">OAuth</a> protokoloa sarbidea baliogabetzeko</li>
            </ul>
        </p>
    </section>

    <section class="slide">
        <h2>Sarbide-kontrola apurtzea: adibidea</h2>
        <p>SQL deia kontuko informazioa lortzeko, egiaztatu gabeko datuekin:</p>
        <pre>
            <code>pstmt.setString(1, request.getParameter("acct"));</code>
            <code>ResultSet results = pstmt.executeQuery( );</code>
        </pre>
        <p>Erasotzaileak URL hau ikusi behar du soilik: <b>https://example.com/app/accountInfo?acct=notmyacct</b></p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak</h2>
        <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Cryptographic Failures (A02:2021)</a>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak</h2>
        <p>Erabilitako metodo kriptografikoen akatsak, ondorioz datuak azaltzen direlarik</p>
        <p>Datuak babesteko beharrak zehaztea, bai transmisioan, bai biltegiratzean (At rest): datuak babesteko legeak</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak</h2>
        <p>Datuak testu lau gisa transmititzen dira? Kanpoko zein barruko konexioetan (adibidez, karga-balantzearen zerbitzariak): HTTP, SMTP, FTP ...</p>
        <p>Algoritmo edo protokolo zaharkituak edo ahulak erabiltzen dira?</p>
        <p>Gako ahulak edo gako lehenetsiak erabiltzen dira?</p>
        <p>Gakoen kudeaketa egokia erabiltzen da?</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa</h2>
        Gako baten bizi-zikloa:
        <ol>
            <li>Sorkuntza</li>
            <li>Banaketa</li>
            <li>Erabilpena</li>
            <li>Biltegiratzea</li>
            <li>Errotazioa, ezeztapena, suntsipena</li>
        </ol>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: Sorkuntza</h2>
        <p>Algoritmo ahulak ekidin</p>
        <p>Key Generator edo entropia altuko Random Number Generator -ak erabili </p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: Banaketa</h2>
        <p>Man in the middle erasoak ekiditeko SSL/TLS bezalako konexio seguruak erabili</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: Erabilpena</h2>
        <p>Baimendutako pertsonek soilik erabiltzen dituztela gakoak bermatu</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: Biltegiratzea</h2>
        <p>Egokiena hardware dedikatua erabiltzea: <a href="https://en.wikipedia.org/wiki/Hardware_security_module">Hardware Security Module</a>:
            <ul>
                <li>Funtzionatzeari uzten diote sarbide fisiko bat dagoenean</li>
                <li>Estandar zorrotzak betetzen dituzte: <a href="https://csrc.nist.gov/publications/detail/fips/140/3/final">FIPS 140-2</a> (4 maila)</li>
            </ul>
        </p>
        <p>Hodeian ere zerbitzuak erabil daitezke: <a href="https://cloud.google.com/security-key-management">Google Cloud Key Management</a></p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: errotazioa</h2>
        <p>Gako batek bere balio-aldia amaitzen duenean, kendu egiten da, datuak deszifratu eta berriro zifratzen direlarik gako berri batekin
        </p>
        <p>Zenbat eta denbora gehiago egon gakoren bat zirkulazioan, orduan eta arriskutsuagoa izango da</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: ezeztapena edo suntsiketa</h2>
        <p>Gako bat konprometitua izan bada, ezeztatu egin behar da, nahiz eta baliozkotasun-epearen barruan egon</p>
        <p>Ezeztatutako gakoa gordetzea eskatzen duten estandarrak daude, etorkizunean datuak deszifratzeko behar izanez gero (adibidez, epaiketa batean)</p>
        <p>Gakoa erabat suntsitu: etorkizunean ezin da erabili</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: jardunbide egokiak</h2>
        <p>Ez idatzi gakoaren balioak software-kodean, nahiz eta segurua izan</p>
        <p>Pribilegio txikienaren printzipioa: erabiltzaile batek benetan behar dituen gakoetarako sarbidea soilik izan beharko luke</p>
        <p>HSM-ak erabili</p>
    </section>

    <section class="slide">
        <h2>Gakoen kudeaketa: jardunbide egokiak</h2>
        <p>Gakoen kudeaketa ahalik eta gehien automatizatu</p>
        <p>Sorkuntza, Banaketa etab. pertsona desberdinen artean banatu</p>
        <p>Gakoak zatietan banatu</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak</h2>
        <p>Zerbitzariaren ziurtagiria baliozkoa eta konfiantzazkoa da, eta AC batek bermatzen du?</p>
        <p>Erabiltzaileen pasahitzak zuzenean gako gisa erabiltzen al dira, Pasword Based Key Derivation Functions (PBKDFs) erabili beharrean?</p>
        <p>Ausazkotasun-hazia behar bezain indartsua al da?</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: prebentzioa</h2>
        <p>Transmititutako, prozesatutako eta biltegiratutako datuak pribatutasun-mailaren arabera sailkatu</p>
        <p>Ahalik eta datu pribatu gutxien biltegiratzea, nahiz eta <a href="https://www.securitymetrics.com/blog/what-tokenization-and-how-can-i-use-it-pci-dss-compliance">Tokenizazioa</a> bezalako metodoak erabili</p>
        <p>Biltegiratutako datu guztiak zifratu (Encription at rest)</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: prebentzioa</h2>
        <p>Algoritmo eguneratuak (MD5, SHA1, ... ez), gako indartsuak, eta Gakoen kudeaketa erabili</p>
        <p>transmititzen diren datua guztiak zifratu TLS FS bidez (TLS + Forward Secrecy)</p>
        <p>Bezeroan datu berezientzako ez baimendu cache-en erabilpena</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: prebentzioa</h2>
        <p>Pasahitzak hash eta gatzarekin biltegiratu</p>
        <p>Entropia posible handiena duten haziak erabili</p>
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: adibideak</h2>
        <p>Una aplicación usa la función por defecto de la base de datos para encriptar datos. Sin embargo estos datos se desencriptan automáticamente al consultarlos, permitiendo el acceso si por ejemplo hay un ataque de Injekzioa SQL</p> 
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: adibideak</h2>
        <p>Web orrialde batek ez du TLS erabilpena derrigortzen. Erasotzaile batek trafikoa monitorizatzen badu eta konexio bat HTTPStik HTTPera "jaisten" badu, kontsultak eten eta erabiltzailearen saioko cookiea lor dezake. Erasotzaileak cookiea (replay) birbidaltzen du erabiltzailearen saioa bahituz eta erabiltzaile-datuetarako sarbidea lortuz</p>
        <p>Datu baseak gatz gabeko hash-ak erabiltzen ditu. Erasotzaile batek hash-ak prekalkulatu ditzake <a href="https://en.wikipedia.org/wiki/Graphics_processing_unit">GPU</a>-ak erabiliz</p>  
    </section>

    <section class="slide">
        <h2>Akats kriptografikoak: ahuleziak</h2>
        <ul>
            <li><a href="https://cwe.mitre.org/data/definitions/259.html">CWE-259: Use of Hard-coded Password</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/327.html">CWE-327: Broken or Risky Crypto Algorithm</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/331.html">CWE-331: Insufficient Entropy</a></li>
            <li>...</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Injekzioa</h2>
         <a href="https://owasp.org/Top10/A03_2021-Injection/">Injection (A03:2021)</a>
    </section>

    <section class="slide">
        <h2>Injekzioa</h2>
        Una aplicación es vulnerable si:
        <ul>
            <li>Los datos que provee el usuario no se validan, filtran, o limpian</li>
            <li>El intérprete usa directamente consultas dinámicas o llamadas no parametrizadas sin "escaping"</li>
            <li>Datos hostiles introducidos por el usuario son usados directamente. La sentencia SQL o comando que se use contiene estructuras/datos maliciosos en consultas dinámicas, comandos, o procedimientos almacenados</li>
        </ul>

    </section>

    <section class="slide">
        <h2>Injekzioa SQL</h2>
        <p><img  style="border: 1px solid #555;"  src="pictures-sgssi-01/boy.png" alt="Bobby tables" width="90%"></p>
        <p style="text-align:left;font-size:30%;"><a href="https://xkcd.com/327/">https://xkcd.com/327/</a></p>
    </section>

    <section class="slide">
        <h2>Injekzioa SQL</h2>
        <pre><code>
txtUserId = getRequestString("UserId");
txtSQL = "SELECT * FROM Users 
WHERE UserId = " + txtUserId;
        </code></pre> 
    </section>

    <section class="slide">
        <h2>Injekzioa SQL</h2>
        Input web: <code>105 OR 1=1</code>
        <pre><code>SELECT * FROM Users WHERE UserId = 105 OR 1=1;
        </code></pre>
        OR 1=1 es siempre true, va a devolver todas las lineas de la columna Users 
    </section>

    <section class="slide">
        <h2>Consultas parametrizadas</h2>
        <p>Parametros: valores que se añaden a la consulta al ejecutarla y son analizadas de forma literal (ej. si la variable hace referencia a nombres de columnas, el interprete se asegura de que los parametros son nombres de columnas antes de añadirlas a la consulta y ejecutarla) </p>   
    </section>

    <section class="slide">
        <h2>Consultas parametrizadas</h2>
        <pre><code>
$stmt = $dbh->prepare("INSERT INTO Customers 
(CustomerName,Address,City) 
VALUES (:nam, :add, :cit)");
$stmt->bindParam(':nam', $txtNam);
$stmt->bindParam(':add', $txtAdd);
$stmt->bindParam(':cit', $txtCit);
$stmt->execute();
        </code></pre>    
    </section>

    <section class="slide">
        <h2>Object-Relational Mapping (ORM)</h2>
        <p>Frameworks que traducen el contenido de la base de datos a objetos</p>
        <p>No hay una conexion directa con la base de datos</p>
    </section>

    <section class="slide">
        <h2>Object-Relational Mapping (ORM)</h2>
        <pre><code>
String sql = "SELECT ... FROM persons WHERE id = 10"
DbCommand cmd = new DbCommand(connection, sql);
Result res = cmd.Execute();
String name = res[0]["FIRST_NAME"];
Person p = repository.GetPerson(10);
String name = p.FirstName;
        </code></pre>
    </section>

    <section class="slide">
        <h2>Injekzioa: detección de vulnerabilidad</h2>
        <p>Revisión del código fuente</p>
        <p>Testeo automatizado de inputs en forma de parametros, cabeceras HTTP, URLs, cookies, JSON, y XML</p>
        <p>Application Security Testing en pipelines de <a href="https://github.com/mikel-egana-aranguren/Transparent-Relations-Ontology/blob/main/.github/workflows/robot.yml">Integración Continua</a>/Despliegue Continuo</p>
        
    </section>

    <section class="slide">
        <h2>Injekzioa: prebentzioa</h2>
        <p>Usar APIs seguras que no usen el intérprete. Si no es posible, usar llamadas parametrizadas u ORM</p>
        <p>Validar los inputs</p>
        <p>"Escapar" todos los caracteres especiales posibles</p>
        <p>Usar controles como LIMIT en SQL para evitar perdida masiva de datos</p>        
    </section>

    <section class="slide">
        <h2>Injekzioa</h2>
        <ul>
            <li><a href="https://cwe.mitre.org/data/definitions/79.html">CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/89.html">CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')</a></li>
            <li><a href="https://cwe.mitre.org/data/definitions/73.html">CWE-73: External Control of File Name or Path</a></li>
            <li>...</li>
        </ul>
    </section>





    
    <!-- FOOTER -->

    <footer class="badge">
        <a href="https://github.com/mikel-egana-aranguren/EHU-SGSSI-01">Fork me on GitHub</a>
    </footer>

    <div class="progress"></div>

    <script src="../ShowerTemplate/shower/shower.js"></script>
    <!-- Copyright © 3000 Yours Truly, Famous Inc. -->

</body>
</html>
